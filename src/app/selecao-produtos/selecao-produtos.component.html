<div class="p-gutter p-grid p-align-baseline">
  <span class="p-col-2 ui-float-label">
    <input
      id="float-input"
      required
      type="text"
      size="30"
      [(ngModel)]="config.tempoScan"
      pInputText
    />
    <label for="float-input">Sincronização em minutos</label>
  </span>
  <p-button
    class="p-col-1"
    type="button"
    label="Salvar"
    (click)="salvarConfigTempoScan()"
  ></p-button>
</div>

<p-tabView (onChange)="buscarProdutosPromocao($event)">
  <p-tabPanel header="Seleção de Produtos">
    <p-card class="content">
      <div class="p-col-8 input">
        <p-autoComplete
          [suggestions]="produtos"
          (completeMethod)="buscarProdutos($event)"
          [size]="60"
          delay="400"
          minLength="3"
          field="nome"
          placeholder="Busque produtos para enviar"
        >
        </p-autoComplete>
      </div>
      <div class="p-col-12">
        <p-dataView [paginator]="true" [rows]="10" [value]="produtos">
          <p-header class="p-grid">
            <div class="p-col-3 text-center">Nome</div>
            <div class="p-col-3 text-center">Quantidade Atual</div>
            <div class="p-col-3 text-center">Setor</div>
            <div class="p-col-2 text-center">Preço</div>
            <div class="p-col-1 text-center">Ativar?</div>
          </p-header>

          <ng-template let-produto pTemplate="listItem">
            <p-card class="p-col-12 p-nogutter">
              <div class="p-grid p-justify-around p-align-baseline">
                <div class="p-col-3 text-center">
                  {{ produto.nome }}
                </div>
                <div class="p-col-3 text-center">
                  {{ produto.qtAtual }}
                </div>
                <p-dropdown class="p-col-3 text-center" [options]="setores" [(ngModel)]="produto.setor"></p-dropdown>

                <div class="p-col-2 text-center">
                  {{ produto.valor | currencyCustom }}
                </div>
                <div class="p-col-1 text-center">
                  <p-toggleButton
                    onLabel="Sim"
                    offLabel="Não"
                    [(ngModel)]="produto.selecionado"
                  ></p-toggleButton>
                </div>
              </div>
            </p-card>
          </ng-template>
        </p-dataView>
      </div>
      <button
        pButton
        [disabled]="produtos.length === 0"
        label="Enviar"
        (click)="enviarProdutos()"
      ></button>
    </p-card>
  </p-tabPanel>

  <p-tabPanel header="Produtos Enviados">
    <p-card class="content p-nogutter">
      <div class="p-col-8 input">
        <p-autoComplete
          #inputAutoComplete
          [suggestions]="produtosPromocaoFilter"
          (completeMethod)="filtroProdutosPromocao($event)"
          [size]="60"
          delay="200"
          minLength="1"
          field="descricao"
          placeholder="Busque um produto"
          (onBlur)="restoreProdutosPromocao()"
        >
        </p-autoComplete>
      </div>
      <div class="p-col-12">
        <p-dataView
          [pageLinks]="pageLinks"
          [paginator]="true"
          [rows]="10"
          [value]="produtosPromocaoFilter"
        >
          <p-header class="p-grid p-justify-center">
            <div class="p-col-2 text-center">Nome</div>
            <div class="p-col-2 text-center">Quantidade Atual</div>
            <div class="p-col-2 text-center">Preço</div>
            <div class="p-col-2 text-center">Vigência Promoção</div>
            <div class="p-col-1 text-center">Ativo</div>
            <div class="p-col-1 text-center">Sincronizado</div>
            <div class="p-col-2 text-center">Ações</div>
          </p-header>

          <ng-template let-produto pTemplate="listItem">
            <p-card class="p-col-12 p-nogutter">
              <div class="p-grid p-justify-around p-align-baseline">
                <div class="p-col-2 text-center">
                  {{ produto.nome }}
                </div>
                <div class="p-col-2 text-center">
                  {{ produto.qtAtual }}
                </div>
                <div class="p-col-2 text-center">
                  {{ produto.valor | currencyCustom }}
                </div>
                
                <div *ngIf="produto.dtInicio && produto.dtFim; else semInfo" class="p-col-2 text-center">
                  de {{ produto.dtInicio | date: "dd/MM/yyyy" }}<br />
                  hà {{ produto.dtFim | date: "dd/MM/yyyy" }}
                </div>
                
                <ng-template #semInfo>
                  <div class="p-col-2 text-center">
                    Indeterminado.
                  </div>
                </ng-template>

                <div class="p-col-1 text-center">
                  {{ produto.ativo ? "Sim" : "Não" }}
                </div>

                <div class="p-col-1 text-center">
                  <i *ngIf="produto.log" 
                    class="log pi pi-exclamation-circle"
                    (mouseover)="showLogs(true, produto.id)"
                    (mouseleave)="showLogs(false, produto.id)"
                    >
                  </i>
                  
                  {{ produto.sync ? "Sim" : "Não" }}

                  <div id="log-{{produto.id}}" class="logs log-hide">
                    {{produto.log}}
                  </div>

                </div>
                
                <div class="p-col-2 text-center">
                  <p-splitButton
                    *ngIf="produto.ativo"
                    label="Desativar"
                    (onClick)="desativarProduto()"
                    icon="pi pi-times"
                    [model]="acoes"
                  ></p-splitButton>

                  <p-splitButton
                    *ngIf="!produto.ativo"
                    label="Ativar"
                    (onClick)="ativarProduto()"
                    icon="pi pi-check"
                  ></p-splitButton>
                </div>
              </div>
            </p-card>
          </ng-template>
        </p-dataView>
      </div>
    </p-card>
  </p-tabPanel>
</p-tabView>
